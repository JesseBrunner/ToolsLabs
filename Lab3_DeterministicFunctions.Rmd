Deterministic functions: EMD chapter 3
========================================================
_Adapted from a lab by Jacqui Frair & John Stella (2011), which was adapted from one by Jesse Brunner (2009) with additional metrials from Ben Bolker (2005)._

Our goals in this lab are to: 

1. get a feel for a suite of important deterministic functions, seeing how their parameters changer their shapes and behavior
2. create reference figures that you can refer to when using these functions
3. learn to create your own function

Creating functions: the negative exponential
--------------------------------------------

There are a number of "built in" deterministic functions in R, but it will be very useful if we can create our own. It turns out that they are very easy to make. To illustrate how we do this, let’s make a function that computes values of negative exponential:
$$
  \begin{aligned}
  y & = a \times \exp(-bx)
  \end{aligned}
$$

The basic syntax of any function is:
```{r NegExp.1, eval=FALSE}
FunctionName <- function() {}
```

The stuff inside the parentheses is list of "arguments" that the function takes (or requires). The negative exponential function requires one or more $x$-values, as well as two parameters, $a$ and $b$. 
```{r NegExp.2, eval=FALSE}
NegExp <- function(x, a, b) {}
```

The stuff inside the curly brackets is the heart of the function, the part that does something. In our case, it does the math:
```{r NegExp.3}
NegExp <- function(x, a, b) {a*exp(-b*x)}
```
It is worth noting that by default the last value that is calculated in a function is "returned". In this case, it means that the value of `a*exp(-b*x` is returned. In more complex functions, it is worth being explicit about what it returned. You can do this with the `return()` function, as so:

Let's try this function and see how it works. First, let's create a sequence of $x$-values, then we will plug them into our `NegExp()` function. 
```{r NegExp.call}
x <- seq(from = 0, to = 10, length = 50)
y <- NegExp(x, a = 1, b = 1)
y
```

Right. So we feed our function a vector of x-values and it spits out a vector of y-values, which, at first glance, seem to be about right. Let’s plot it and see.

```{r NegExp.plot, fig.width = 5, fig.height = 4}
library(ggplot2) #don't forget to load the package
qplot(x,y, geom = "line")
```

It works! Whoo hoo! Your first function! 

Now, we can make two important changes. First, we can provide default, but override-able values to the arguments of a function. This is good practice because a) it lets you specify _just_ the thing(s) you want to change and b) there are built in "reasonable" values. It’s good to get in the habit.

```{r NegExp.4, fig.width = 5, fig.height = 4}
NegExp <- function(x, a = 1, b = 1) {a*exp(-b*x)}
y.1 <- NegExp(x) # using default values
qplot(x, y.1, geom = "line")
y.2 <- NegExp(x, b=1/3) # using default value of a, but changing b
qplot(x, y.2, geom = "line")

```

The other thing to note, as I mentioned before, is that our function is returning a vector of values. We'll see later that a function can do a whole bunch of things, but it can only return one object (a vector, a matrix, a list...).  
By default a function returns the result of the last calculation, but with more complicated functions it is good practice to specify the thing you want returned by using `return(ThingToReturn)`. So in our case we would write:
```{r NegExp.5}
NegExp <- function(x, a = 1, b = 1) {
  y <- a*exp(-b*x)
  return(y)
  }
```
And there you go; you're first fully developed function in R!

Plotting curves with `stat_function()`
--------------------------------------
Instead of generating a vector of x-values, calculating y-values, and then plotting them against each other, we can use the built‐in `stat_function()` of the ggplot2 package. It is designed for just this purpose.

We can plot any function we like, such as this one:
```{r madeup.stat_fun, fig.width = 5, fig.height = 4}
qplot(x=c(0,5), stat="function", fun=function(x)  10*(1 -exp(-2*x) -1/30*x^2), geom="line")
```

Or use named functions, like our `NegExp()` function (or anything else built into R).
```{r NegExp.stat_fun, fig.width = 5, fig.height = 4}
qplot(x=c(0,10), stat="function", fun=NegExp, geom="line")
```

If we want to plot more than one curve on the same axes, we need to use the `ggplot()` version of things, rather than `qplot()`. We are assigning color to different character strings in the `aes()` part, so that the function knows to create entries in a legend for each with the appropriate colors. We then have to specify values of the colors and the breaks within the `scale_colour_manual()` function. Note that the names are assigned alphabetical, so even though "`a=0.5, b=1`" is the last entry, it gets the first color listed (here, darkgreen).

```{r guide.NegExp}
NE <- ggplot(data.frame(x=c(0,10)), aes(x)) +   
stat_function(fun=NegExp, geom="line", args = list(a=1, b = 0.5), aes(colour="a=1, b=0.5")) +   
stat_function(fun=NegExp, geom="line", args = list(a=1, b = 1), aes(colour="a=1, b=1")) +   
stat_function(fun=NegExp, geom="line", args = list(a=1, b = 2), aes(colour="a=1, b=2")) +   
stat_function(fun=NegExp, geom="line", args = list(a=1/2, b = 1), aes(colour="a=0.5, b=1")) +   
scale_colour_manual("Parameters", values=c("darkgreen", "lightblue","blue","darkblue"), breaks=c("a=1, b=0.5", "a=1, b=1", "a=1, b=2", "a=0.5, b=1")) +   
labs(title = "Negative Exponential") + theme_bw()

NE
```

I think that this sort of figure is a handy reference. You may want to turn this into a pdf and keep it handy or print it out. It's relatively easy to do:
```{r NegExp.pdf, eval=FALSE}
ggsave(NE, file="NegativeExponential.pdf", width = 8, height = 6) # width in inches, by default
```

More functions to explore
-------------------------

You should try to at least understand the behavior of, if not create a similar reference pdf of the following deterministic functions. See where they saturate, where the half-maximum shows up, where they wiggle, etc. The approach is the same. Try to code them yourself. If you have trouble with the math, see below.

**Hyperbolic**  
$$
  \begin{aligned}
  y & = \frac{a}{b+x} 
  \end{aligned}
$$

**Michaelis-Menton**
$$
  \begin{aligned}
  y & = \frac{ax}{b+x} 
  \end{aligned}
$$

**Holling Type III**
$$
  \begin{aligned}
  y & = \frac{ax^2}{b^2+x^2} 
  \end{aligned}
$$

**Holling Type IV**
$$
  \begin{aligned}
  y & = \frac{ax^2}{b+cx+x^2} 
  \end{aligned}
$$

**Monomolecular**
$$
  \begin{aligned}
  y & = a(1-exp(-bx)) 
  \end{aligned}
$$

**Ricker**
$$
  \begin{aligned}
  y & = ax \times exp(-bx)
  \end{aligned}
$$

**Logistic**
$$
  \begin{aligned}
  y & = \frac{exp(a+bx)}{1+exp(a+bx)}
  \end{aligned}
$$
   

These are for your own benefit, so there is no need to send me anything unless you have questions or produce something really cool.
   

ifelse() for Piece-wise Functions 
--------------------------------

The `ifelse()` command in R is useful for constructing piece-wise functions.  Its basic syntax is `ifelse(condition, value_if_true, value_if_false)`, where `condition` is a logical vector (e.g., `x > 0`), `value_if_true` is a vector of alternatives to use if condition is `TRUE`, and `value_if_false` is a vector of alternatives to use if condition is `FALSE`.  If you specify just one value, it will be expanded (recycled in R jargon) to be the right length.  A simple example:
```{r ifelse.example}
x <- c(-25, -16, -9, -4, -1, 0, 1, 4, 9, 16, 25)
ifelse(x < 0, 0, sqrt(x))
```

These commands produce a warning message, but it’s OK to ignore it since you know you’ve taken care of the problem.  (If you said `sqrt(ifelse(x < 0, 0, x))` instead you wouldn’t get a warning. Why not? Do you think this would be a better way to formulate)

Here are some examples of using `ifelse()` to generate 

1. a simple threshold   
2. a Holling type I or “hockey stick”   
3. a more complicated piece-wise model that grows exponentially and then decreases linearly   
4. a double-threshold model   

```{r ifelse.plots}

ggplot(data.frame(x=c(0,5)), aes(x)) +   
stat_function(fun=function(x) ifelse(x < 2, 1/2, 2), geom="line", aes(colour="ifelse(x < 2, 1/2, 2)")) +   
stat_function(fun=function(x) ifelse(x < 2, 2 * x, 4), geom="line", aes(colour="ifelse(x < 2, 2 * x, 4)")) +   
stat_function(fun=function(x) ifelse(x < 2, exp(x), 7*exp(-(x-2)/4)), geom="line", aes(colour="ifelse(x < 2, exp(x), 7*exp(-(x-2)/4))")) +   
stat_function(fun=function(x) ifelse(x < 2, 1, ifelse(x < 4, 3, 5)), geom="line", aes(colour="ifelse(x < 2, 1, ifelse(x < 4, 3, 5))")) +   
scale_colour_manual("Piecewise model", values=c("violet", "blue","darkblue","lightblue"), breaks=c("ifelse(x < 2, 1/2, 2)", "ifelse(x < 2, 2 * x, 4)", "ifelse(x < 2, exp(x), 7*exp(-(x-2)/4))", "ifelse(x < 2, 1, ifelse(x < 4, 3, 5))")) + theme_bw() +   
	theme(legend.position=c(0,1), legend.justification=c(0,1), legend.background = element_blank())

# Notice that last call to theme(). 
# I'm specifying the position and justification to move
# the legend position to the upper left of the graph 
# so that it doesn't squish the graph itself. 
# The part about the background is to prevent the  
# legend's white background from covering the lines.
# element_blank() is way to "delete" an element
```

The double-threshold example (nested `ifelse()` commands) probably needs more explanation.   In words, this command would read “if x is less than 2, set y to 1; otherwise (where x ≥ 2), if x is less than 4 (i.e., 2 ≤ x < 4), set y to 3; otherwise (where x ≥ 4), set y to 5”.        

   
Homework: Which curve?
-------------------------

1. On page 96 in EMD, Bolker states that the logistic is popular because it is a simple sigmoid function, but then indicates that its "rational analogue," the Holling Type III functional response is also a simple sigmoid function. Does that mean they are interchangeable? Can you get a Holling type III curve to look like a logistic or vice versa? (Say, from 0 to 10.) If so, under what parameters?

2. What about the hyperbolic and the negative exponential?

Send me one figure for each pair showing me how close you were able to get. Make sure you label your axes, etc., and indicate the parameter combinations you used. Closest fit in the class gets a beer.

Please send me the html file that shows your code and figure in the format `MyName_Lab2.html`

    
    
    
    
---------------
---------------
---------------
---------------

```{r morefunctions}
Hyperbolic <- function(x, a = 2, b = 3) { a/(b+x) }  
MichMent <- function(x, a = 2, b = 1) { a*x / (b + x) }  
Holling3 <- function(x, a = 2, b = 1) { (a*x^2) / (b^2 + x^2) }  
Holling4 <- function(x, a = 2, b = 3, c = -1) { (a*x^2) / (b + c*x + x^2) }   
Monomolecular <- function(x, a = 2, b = 3) { a*(1 - exp(-b*x) ) }  
Ricker <- function(x, a = 2, b = 3) { a*x * exp(-b*x) }  
Logistic <- function(x, a = 0, b = 1) { exp(a+b*x) / (1 + exp(a+b*x) ) }  
```








```{r guide.Hyperbolic, echo=FALSE, eval=FALSE}

#### NEED TO ADJUST PARAMETES & COLORS

Hyp <- ggplot(data.frame(x=c(0,10)), aes(x)) +   
stat_function(fun=Hyperbolic, geom="line", args = list(a=1, b = 0.5), aes(colour="a=1, b=0.5")) +   
stat_function(fun=Hyperbolic, geom="line", args = list(a=1, b = 1), aes(colour="a=1, b=1")) +   
stat_function(fun=Hyperbolic, geom="line", args = list(a=1, b = 5), aes(colour="a=1, b=5")) +   
stat_function(fun=Hyperbolic, geom="line", args = list(a=1/2, b = 1), aes(colour="a=0.5, b=1")) +   	stat_function(fun=Hyperbolic, geom="line", args = list(a=5, b = 1), aes(colour="a=2, b=1")) +
scale_colour_manual("Parameters", values=c("orange", "green","black","darkgreen", "red"), breaks=c("a=1, b=0.5", "a=1, b=1", "a=1, b=5", "a=0.5, b=1", "a=5, b=1")) +   
labs(title = "Hyperbolic") + theme_bw()
Hyp
```

```{r guide.MichMent, echo=FALSE, eval=FALSE}
MM <- ggplot(data.frame(x=c(0,10)), aes(x)) +   
stat_function(fun=MichMent, geom="line", args = list(a=1, b = 0.5), aes(colour="a=1, b=0.5")) +   
stat_function(fun=MichMent, geom="line", args = list(a=1, b = 1), aes(colour="a=1, b=1")) +   
stat_function(fun=MichMent, geom="line", args = list(a=1, b = 5), aes(colour="a=1, b=5")) +   
stat_function(fun=MichMent, geom="line", args = list(a=1/2, b = 1), aes(colour="a=0.5, b=1")) +   	stat_function(fun=MichMent, geom="line", args = list(a=5, b = 1), aes(colour="a=2, b=1")) +
scale_colour_manual("Parameters", values=c("orange", "green","black","darkgreen", "red"), breaks=c("a=1, b=0.5", "a=1, b=1", "a=1, b=5", "a=0.5, b=1", "a=5, b=1")) +   
labs(title = "Michaelis-Menton") + theme_bw()
MM
```


```{r guide.Holling3, echo=FALSE, eval=FALSE}
H3 <- ggplot(data.frame(x=c(0,10)), aes(x)) +   
stat_function(fun=Holling3, geom="line", args = list(a=1, b = 0.5), aes(colour="a=1, b=0.5")) +   
stat_function(fun=Holling3, geom="line", args = list(a=1, b = 1), aes(colour="a=1, b=1")) +   
stat_function(fun=Holling3, geom="line", args = list(a=1, b = 5), aes(colour="a=1, b=5")) +   
stat_function(fun=Holling3, geom="line", args = list(a=1/2, b = 1), aes(colour="a=0.5, b=1")) +   	stat_function(fun=Holling3, geom="line", args = list(a=5, b = 1), aes(colour="a=2, b=1")) +
scale_colour_manual("Parameters", values=c("orange", "green","black","darkgreen", "red"), breaks=c("a=1, b=0.5", "a=1, b=1", "a=1, b=5", "a=0.5, b=1", "a=5, b=1")) +   
labs(title = "Holling Type III") + theme_bw()
H3
```

```{r guide.Holling4, echo=FALSE, eval=FALSE}

### add in parameter c
H4 <- ggplot(data.frame(x=c(0,10)), aes(x)) +   
stat_function(fun=Holling4, geom="line", args = list(a=1, b = 0.5), aes(colour="a=1, b=0.5")) +   
stat_function(fun=Holling4, geom="line", args = list(a=1, b = 1), aes(colour="a=1, b=1")) +   
stat_function(fun=Holling4, geom="line", args = list(a=1, b = 5), aes(colour="a=1, b=5")) +   
stat_function(fun=Holling4, geom="line", args = list(a=1/2, b = 1), aes(colour="a=0.5, b=1")) +   	stat_function(fun=Holling4, geom="line", args = list(a=5, b = 1), aes(colour="a=2, b=1")) +
scale_colour_manual("Parameters", values=c("orange", "green","black","darkgreen", "red"), breaks=c("a=1, b=0.5", "a=1, b=1", "a=1, b=5", "a=0.5, b=1", "a=5, b=1")) +   
labs(title = "Holling Type IV") + theme_bw()
H4
```

```{r guide.Monomolecular, echo=FALSE, eval=FALSE}
Mono <- ggplot(data.frame(x=c(0,10)), aes(x)) +   
stat_function(fun=Monomolecular, geom="line", args = list(a=1, b = 0.5), aes(colour="a=1, b=0.5")) +   
stat_function(fun=Monomolecular, geom="line", args = list(a=1, b = 1), aes(colour="a=1, b=1")) +   
stat_function(fun=Monomolecular, geom="line", args = list(a=1, b = 5), aes(colour="a=1, b=5")) +   
stat_function(fun=Monomolecular, geom="line", args = list(a=1/2, b = 1), aes(colour="a=0.5, b=1")) +   	stat_function(fun=Monomolecular, geom="line", args = list(a=5, b = 1), aes(colour="a=2, b=1")) +
scale_colour_manual("Parameters", values=c("orange", "green","black","darkgreen", "red"), breaks=c("a=1, b=0.5", "a=1, b=1", "a=1, b=5", "a=0.5, b=1", "a=5, b=1")) +   
labs(title = "Monomolecular") + theme_bw()
Mono
```


```{r guide.Ricker, echo=FALSE, eval=FALSE}
Rick <- ggplot(data.frame(x=c(0,10)), aes(x)) +   
stat_function(fun=Ricker, geom="line", args = list(a=1, b = 0.5), aes(colour="a=1, b=0.5")) +   
stat_function(fun=Ricker, geom="line", args = list(a=1, b = 1), aes(colour="a=1, b=1")) +   
stat_function(fun=Ricker, geom="line", args = list(a=1, b = 5), aes(colour="a=1, b=5")) +   
stat_function(fun=Ricker, geom="line", args = list(a=1/2, b = 1), aes(colour="a=0.5, b=1")) +   	stat_function(fun=Ricker, geom="line", args = list(a=5, b = 1), aes(colour="a=2, b=1")) +
scale_colour_manual("Parameters", values=c("orange", "green","black","darkgreen", "red"), breaks=c("a=1, b=0.5", "a=1, b=1", "a=1, b=5", "a=0.5, b=1", "a=5, b=1")) +   
labs(title = "Ricker") + theme_bw()
Rick
```

```{r guide.Logistic, echo=FALSE, eval=FALSE}
Logist <- ggplot(data.frame(x=c(0,10)), aes(x)) +   
stat_function(fun=Logistic, geom="line", args = list(a=1, b = 0.5), aes(colour="a=1, b=0.5")) +   
stat_function(fun=Logistic, geom="line", args = list(a=1, b = 1), aes(colour="a=1, b=1")) +   
stat_function(fun=Logistic, geom="line", args = list(a=1, b = 5), aes(colour="a=1, b=5")) +   
stat_function(fun=Logistic, geom="line", args = list(a=1/2, b = 1), aes(colour="a=0.5, b=1")) +   	stat_function(fun=Logistic, geom="line", args = list(a=5, b = 1), aes(colour="a=2, b=1")) +
scale_colour_manual("Parameters", values=c("orange", "green","black","darkgreen", "red"), breaks=c("a=1, b=0.5", "a=1, b=1", "a=1, b=5", "a=0.5, b=1", "a=5, b=1")) +   
labs(title = "Logistic") + theme_bw()
Logist
```